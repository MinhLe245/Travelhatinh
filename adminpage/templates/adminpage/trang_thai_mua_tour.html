{% extends "adminpage/base.html" %}
{% load static %}
{% block test_sontent %}

<div class="container mt-4">
  <div class="mb-3 text-start">
    <a href="{% url 'hometour' %}" class="btn btn-outline-secondary">
      <i class="fas fa-arrow-left"></i> Quay l·∫°i
    </a>
  </div>

  <h2 class="text-primary mb-3">üìã Tr·∫°ng th√°i c√°c Tour ƒë√£ ƒë∆∞·ª£c ƒë·∫∑t</h2>
  <p class="text-muted">Theo d√µi ti·∫øn ƒë·ªô v√† tr·∫°ng th√°i c·ªßa c√°c tour kh√°ch ƒë√£ ƒë·∫∑t.</p>

  <div class="card shadow-sm">
    <div class="card-body">
      <table class="table table-hover align-middle">
        <thead class="table-dark">
          <tr>
            <th># M√£ ƒë∆°n</th>
            <th>M√£ Tour</th>
            <th>T√™n Tour</th>
            <th>Ng√†y b·∫Øt ƒë·∫ßu</th>
            <th>Tr·∫°ng th√°i</th>
            <th>L√Ω do h·ªßy (n·∫øu c√≥)</th>
          </tr>
        </thead>
        <tbody>
          {% for don in danh_sach_don %}
          <tr>
            <td>#{{ don.ma_don }}</td>
            <td>{{ don.ma_tour }}</td>
            <td><strong>{{ don.ten_tour }}</strong></td>
            <td>{{ don.ngay_bat_dau|date:"d/m/Y" }}</td>
            <td>
              {% if don.trang_thai == "S·∫Øp b·∫Øt ƒë·∫ßu" %}
                <span class="badge bg-primary">{{ don.trang_thai }}</span>
                <button class="btn btn-sm btn-outline-danger mt-1" 
                        data-bs-toggle="modal" 
                        data-bs-target="#huyTourModal"
                        data-id="{{ don.ma_don }}"
                        data-ma="{{ don.ma_tour }}">
                  <i class="bi bi-x-circle"></i> H·ªßy
                </button>
              {% elif don.trang_thai == "ƒêang di·ªÖn ra" %}
                <span class="badge bg-success">{{ don.trang_thai }}</span>
              {% elif don.trang_thai == "ƒê√£ k·∫øt th√∫c" %}
                <span class="badge bg-secondary">{{ don.trang_thai }}</span>
              {% elif don.trang_thai == "ƒê√£ h·ªßy" %}
                <span class="badge bg-danger">{{ don.trang_thai }}</span>
              {% endif %}
            </td>
            <td>
              {% if don.ly_do_huy %}
                <span class="text-danger fst-italic">{{ don.ly_do_huy }}</span>
              {% else %}
                <span class="text-muted">-</span>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted">Ch∆∞a c√≥ tour n√†o ƒë∆∞·ª£c ƒë·∫∑t.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Modal nh·∫≠p l√Ω do h·ªßy -->
<div class="modal fade" id="huyTourModal" tabindex="-1">
  <div class="modal-dialog">
    <form method="POST" action="{% url 'huy_tour' %}">
      {% csrf_token %}
      <input type="hidden" name="order_id" id="modalOrderId">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title text-danger">üõë H·ªßy Tour</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>Nh·∫≠p l√Ω do h·ªßy Tour m√£ <strong id="maTourSpan"></strong>:</p>
          <textarea name="ly_do_huy" class="form-control" rows="3" required></textarea>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-danger">X√°c nh·∫≠n h·ªßy</button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Script ƒë·ªï d·ªØ li·ªáu v√†o modal -->
<script>
  const huyTourModal = document.getElementById('huyTourModal');
  huyTourModal.addEventListener('show.bs.modal', function (event) {
    const button = event.relatedTarget;
    const orderId = button.getAttribute('data-id');
    const maTour = button.getAttribute('data-ma');
    document.getElementById('modalOrderId').value = orderId;
    document.getElementById('maTourSpan').innerText = maTour;
  });
</script>

{% endblock %}
